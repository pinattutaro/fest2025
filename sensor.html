<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>iOS VR-like View</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/three@0.155/build/three.min.js"></script>
</head>
<body style="margin:0; overflow:hidden;">
  <button id="startBtn" style="position:absolute;z-index:10;">Start VR</button>
  <script>
    let scene, camera, renderer;
    let alpha=0, beta=0, gamma=0;

    // Three.js 基本セットアップ
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.z = 0;

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // 簡単なVR空間（床とオブジェクト）
    const floor = new THREE.Mesh(
        new THREE.PlaneGeometry(50, 50),
        new THREE.MeshBasicMaterial({color:0x444444, side:THREE.DoubleSide})
    );
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    for(let i=0;i<30;i++){
        const box = new THREE.Mesh(
            new THREE.BoxGeometry(1,1,1),
            new THREE.MeshNormalMaterial()
        );
        box.position.set((Math.random()-0.5)*20, 0.5, (Math.random()-0.5)*20);
        scene.add(box);
    }

    // デバイスの回転を取得
    function handleOrientation(event){
        alpha = event.alpha ? THREE.MathUtils.degToRad(event.alpha) : 0;
        beta  = event.beta  ? THREE.MathUtils.degToRad(event.beta)  : 0;
        gamma = event.gamma ? THREE.MathUtils.degToRad(event.gamma) : 0;
    }

    function animate(){
        requestAnimationFrame(animate);

        // デバイスの回転をカメラに反映
        const euler = new THREE.Euler(beta, alpha, -gamma, 'YXZ');
        camera.quaternion.setFromEuler(euler);

        renderer.render(scene, camera);
    }

    // iOS Safari はユーザー操作で許可が必要
    document.getElementById('startBtn').addEventListener('click', ()=>{
        if(typeof DeviceOrientationEvent.requestPermission === 'function'){
        DeviceOrientationEvent.requestPermission().then(state=>{
            if(state==='granted'){
                window.addEventListener('deviceorientation', handleOrientation, true);
                animate();
            }
        });
        }else{
            window.addEventListener('deviceorientation', handleOrientation, true);
            animate();
        }
        document.getElementById('startBtn').style.display='none';
    });
  </script>
</body>
</html>
